"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "compareJSON", {
    enumerable: true,
    get: function() {
        return compareJSON;
    }
});
var _type = require("../utilities/type");
var _jsonTypes = require("../jsonTypes");
var _jsonComparisons = require("../jsonComparisons");
var arrayUtilities = require("necessary").arrayUtilities;
var first = arrayUtilities.first;
function compareJSON(jsonA, jsonB) {
    var jsonComparison = MAJOR_VERSION_NUMBER_CHANGE;
    var jsonAType = (0, _type.typeOf)(jsonA), jsonBType = (0, _type.typeOf)(jsonB);
    if (jsonAType === jsonBType) {
        var jsonType = jsonAType; ///
        switch(jsonType){
            case _jsonTypes.ARRAY_JSON_TYPE:
                {
                    var arrayA = jsonA, arrayB = jsonB; ///
                    jsonComparison = compareArrays(arrayA, arrayB);
                    break;
                }
            case _jsonTypes.OBJECT_JSON_TYPE:
                {
                    var objectA = jsonA, objectB = jsonB; ///
                    jsonComparison = compareObjects(objectA, objectB);
                    break;
                }
            case _jsonTypes.PRIMITIVE_JSON_TYPE:
                {
                    var primitiveA = jsonA, primitiveB = jsonB; ///
                    jsonComparison = comparePrimitives(primitiveA, primitiveB);
                    break;
                }
        }
    }
    return jsonComparison;
}
function compareArrays(arrayA, arrayB) {
    var jsonComparison;
    var arrayALength = arrayA.length, arrayBLength = arrayB.length;
    if (arrayALength <= arrayBLength) {
        if (arrayALength === 0) {
            if (arrayALength === arrayBLength) {
                jsonComparison = _jsonComparisons.EQUAL_TO_JSON_COMPARISON;
            } else {
                jsonComparison = _jsonComparisons.STRICTLY_LESS_THAN_JSON_COMPARISON;
            }
        } else {
            var firstJsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
            var elementsA = arrayA, elementsB = arrayB, firstElementA = first(elementsA), elementA = firstElementA; ///
            var foundElementB = null;
            if (foundElementB === null) {
                elementsB.some(function(elementB) {
                    var jsonA = elementA, jsonB = elementB; ///
                    firstJsonComparison = compareJSON(jsonA, jsonB);
                    if (firstJsonComparison === _jsonComparisons.EQUAL_TO_JSON_COMPARISON) {
                        foundElementB = elementB; ///
                        return true;
                    }
                });
            }
            if (foundElementB === null) {
                elementsB.some(function(elementB) {
                    var jsonA = elementA, jsonB = elementB; ///
                    firstJsonComparison = compareJSON(jsonA, jsonB);
                    if (firstJsonComparison === _jsonComparisons.STRICTLY_LESS_THAN_JSON_COMPARISON) {
                        foundElementB = elementB; ///
                        return true;
                    }
                });
            }
            if (firstJsonComparison === _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON) {
                jsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
            } else {
                var elementB = foundElementB; ///
                arrayB = deleteElement(arrayB, elementA); ///
                arrayB = deleteElement(arrayB, elementB); ///
                var jsonA = arrayB, jsonB = arrayB, remainingJSONComparison = compareJSON(jsonA, jsonB);
                if (remainingJSONComparison === _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON) {
                    jsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
                } else {
                    if (firstJsonComparison === _jsonComparisons.STRICTLY_LESS_THAN_JSON_COMPARISON || remainingJSONComparison === _jsonComparisons.STRICTLY_LESS_THAN_JSON_COMPARISON) {
                        jsonComparison = _jsonComparisons.STRICTLY_LESS_THAN_JSON_COMPARISON;
                    } else {
                        jsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
                    }
                }
            }
        }
    } else {
        jsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
    }
    return jsonComparison;
}
function compareObjects(objectA, objectB) {
    var jsonComparison;
    var keysA = Object.keys(objectA), keysB = Object.keys(objectB), keysALength = keysA.length, keysBLength = keysB.length;
    if (keysALength <= keysBLength) {
        if (keysALength === 0) {
            if (keysALength === keysBLength) {
                jsonComparison = _jsonComparisons.EQUAL_TO_JSON_COMPARISON;
            } else {
                jsonComparison = _jsonComparisons.STRICTLY_LESS_THAN_JSON_COMPARISON;
            }
        } else {
            var firstJsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
            var firstKeyA = first(keysA), keyA = firstKeyA; ///
            keysB.some(function(keyB) {
                if (keyB === keyA) {
                    var valueA = objectA[keyA], valueB = objectB[keyB], jsonA = valueA, jsonB = valueB; ///
                    firstJsonComparison = compareJSON(jsonA, jsonB);
                    return true;
                }
            });
            if (firstJsonComparison === _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON) {
                jsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
            } else {
                var keyB = keyA; ///
                objectA = deleteKey(objectA, keyA); ///
                objectB = deleteKey(objectB, keyB); ///
                var jsonA = objectA, jsonB = objectB, remainingJSONComparison = compareJSON(jsonA, jsonB);
                if (remainingJSONComparison === _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON) {
                    jsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
                } else {
                    if (firstJsonComparison === _jsonComparisons.STRICTLY_LESS_THAN_JSON_COMPARISON || remainingJSONComparison === _jsonComparisons.STRICTLY_LESS_THAN_JSON_COMPARISON) {
                        jsonComparison = _jsonComparisons.STRICTLY_LESS_THAN_JSON_COMPARISON;
                    } else {
                        jsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
                    }
                }
            }
        }
    } else {
        jsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
    }
    return jsonComparison;
}
function comparePrimitives(primitiveA, primitiveB) {
    var jsonComparison;
    if (primitiveA === primitiveB) {
        jsonComparison = _jsonComparisons.EQUAL_TO_JSON_COMPARISON;
    } else {
        jsonComparison = _jsonComparisons.NOT_EQUAL_TO_JSON_COMPARISON;
    }
    return jsonComparison;
}
function deleteElement(array, element) {
    var deletedElement = element; ///
    array = array.reduce(function(array, element) {
        if (element !== deletedElement) {
            array.push(element);
        }
        return array;
    }, []);
    return array;
}
function deleteKey(object, key) {
    var deletedKey = key, keys = Object.keys(object), values = Object.values(object);
    object = keys.reduce(function(object, key, index) {
        if (key !== deletedKey) {
            var value = values[index];
            object[key] = value;
        }
        return object;
    }, {});
    return object;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsaXRpZXMvanNvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuY29uc3QgeyBhcnJheVV0aWxpdGllcyB9ID0gcmVxdWlyZShcIm5lY2Vzc2FyeVwiKTtcblxuaW1wb3J0IHsgdHlwZU9mIH0gZnJvbSBcIi4uL3V0aWxpdGllcy90eXBlXCI7XG5pbXBvcnQgeyBBUlJBWV9KU09OX1RZUEUsIE9CSkVDVF9KU09OX1RZUEUsIFBSSU1JVElWRV9KU09OX1RZUEUgfSBmcm9tIFwiLi4vanNvblR5cGVzXCI7XG5pbXBvcnQgeyBFUVVBTF9UT19KU09OX0NPTVBBUklTT04sIE5PVF9FUVVBTF9UT19KU09OX0NPTVBBUklTT04sIFNUUklDVExZX0xFU1NfVEhBTl9KU09OX0NPTVBBUklTT04gfSBmcm9tIFwiLi4vanNvbkNvbXBhcmlzb25zXCI7XG5cbmNvbnN0IHsgZmlyc3QgfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZUpTT04oanNvbkEsIGpzb25CKSB7XG4gIGxldCBqc29uQ29tcGFyaXNvbiA9IE1BSk9SX1ZFUlNJT05fTlVNQkVSX0NIQU5HRTtcblxuICBjb25zdCBqc29uQVR5cGUgPSB0eXBlT2YoanNvbkEpLFxuICAgICAgICBqc29uQlR5cGUgPSB0eXBlT2YoanNvbkIpO1xuXG4gIGlmIChqc29uQVR5cGUgPT09IGpzb25CVHlwZSkge1xuICAgIGNvbnN0IGpzb25UeXBlID0ganNvbkFUeXBlOyAvLy9cblxuICAgIHN3aXRjaCAoanNvblR5cGUpIHtcbiAgICAgIGNhc2UgQVJSQVlfSlNPTl9UWVBFOiB7XG4gICAgICAgIGNvbnN0IGFycmF5QSA9IGpzb25BLCAvLy9cbiAgICAgICAgICAgICAgYXJyYXlCID0ganNvbkI7IC8vL1xuXG4gICAgICAgIGpzb25Db21wYXJpc29uID0gY29tcGFyZUFycmF5cyhhcnJheUEsIGFycmF5Qik7XG5cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGNhc2UgT0JKRUNUX0pTT05fVFlQRToge1xuICAgICAgICBjb25zdCBvYmplY3RBID0ganNvbkEsIC8vL1xuICAgICAgICAgICAgICBvYmplY3RCID0ganNvbkI7IC8vL1xuXG4gICAgICAgIGpzb25Db21wYXJpc29uID0gY29tcGFyZU9iamVjdHMob2JqZWN0QSwgb2JqZWN0Qik7XG5cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGNhc2UgUFJJTUlUSVZFX0pTT05fVFlQRToge1xuICAgICAgICBjb25zdCBwcmltaXRpdmVBID0ganNvbkEsIC8vL1xuICAgICAgICAgICAgICBwcmltaXRpdmVCID0ganNvbkI7IC8vL1xuXG4gICAgICAgIGpzb25Db21wYXJpc29uID0gY29tcGFyZVByaW1pdGl2ZXMocHJpbWl0aXZlQSwgcHJpbWl0aXZlQik7XG5cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGpzb25Db21wYXJpc29uO1xufVxuXG5mdW5jdGlvbiBjb21wYXJlQXJyYXlzKGFycmF5QSwgYXJyYXlCKSB7XG4gIGxldCBqc29uQ29tcGFyaXNvbjtcblxuICBjb25zdCBhcnJheUFMZW5ndGggPSBhcnJheUEubGVuZ3RoLFxuICAgICAgICBhcnJheUJMZW5ndGggPSBhcnJheUIubGVuZ3RoO1xuXG4gIGlmIChhcnJheUFMZW5ndGggPD0gYXJyYXlCTGVuZ3RoKSB7XG4gICAgaWYgKGFycmF5QUxlbmd0aCA9PT0gMCkge1xuICAgICAgaWYgKGFycmF5QUxlbmd0aCA9PT0gYXJyYXlCTGVuZ3RoKSB7XG4gICAgICAgIGpzb25Db21wYXJpc29uID0gRVFVQUxfVE9fSlNPTl9DT01QQVJJU09OO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAganNvbkNvbXBhcmlzb24gPSBTVFJJQ1RMWV9MRVNTX1RIQU5fSlNPTl9DT01QQVJJU09OO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgZmlyc3RKc29uQ29tcGFyaXNvbiA9IE5PVF9FUVVBTF9UT19KU09OX0NPTVBBUklTT047XG5cbiAgICAgIGNvbnN0IGVsZW1lbnRzQSA9IGFycmF5QSwgLy8vXG4gICAgICAgICAgICBlbGVtZW50c0IgPSBhcnJheUIsIC8vL1xuICAgICAgICAgICAgZmlyc3RFbGVtZW50QSA9IGZpcnN0KGVsZW1lbnRzQSksXG4gICAgICAgICAgICBlbGVtZW50QSA9IGZpcnN0RWxlbWVudEE7IC8vL1xuXG4gICAgICBsZXQgZm91bmRFbGVtZW50QiA9IG51bGw7XG5cbiAgICAgIGlmIChmb3VuZEVsZW1lbnRCID09PSBudWxsKSB7XG4gICAgICAgIGVsZW1lbnRzQi5zb21lKChlbGVtZW50QikgPT4ge1xuICAgICAgICAgIGNvbnN0IGpzb25BID0gZWxlbWVudEEsIC8vL1xuICAgICAgICAgICAgICAgIGpzb25CID0gZWxlbWVudEI7IC8vL1xuXG4gICAgICAgICAgZmlyc3RKc29uQ29tcGFyaXNvbiA9IGNvbXBhcmVKU09OKGpzb25BLCBqc29uQik7XG5cbiAgICAgICAgICBpZiAoZmlyc3RKc29uQ29tcGFyaXNvbiA9PT0gRVFVQUxfVE9fSlNPTl9DT01QQVJJU09OKSB7XG4gICAgICAgICAgICBmb3VuZEVsZW1lbnRCID0gZWxlbWVudEI7IC8vL1xuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoZm91bmRFbGVtZW50QiA9PT0gbnVsbCkge1xuICAgICAgICBlbGVtZW50c0Iuc29tZSgoZWxlbWVudEIpID0+IHtcbiAgICAgICAgICBjb25zdCBqc29uQSA9IGVsZW1lbnRBLCAvLy9cbiAgICAgICAgICAgICAgICBqc29uQiA9IGVsZW1lbnRCOyAvLy9cblxuICAgICAgICAgIGZpcnN0SnNvbkNvbXBhcmlzb24gPSBjb21wYXJlSlNPTihqc29uQSwganNvbkIpO1xuXG4gICAgICAgICAgaWYgKGZpcnN0SnNvbkNvbXBhcmlzb24gPT09IFNUUklDVExZX0xFU1NfVEhBTl9KU09OX0NPTVBBUklTT04pIHtcbiAgICAgICAgICAgIGZvdW5kRWxlbWVudEIgPSBlbGVtZW50QjsgLy8vXG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChmaXJzdEpzb25Db21wYXJpc29uID09PSBOT1RfRVFVQUxfVE9fSlNPTl9DT01QQVJJU09OKSB7XG4gICAgICAgIGpzb25Db21wYXJpc29uID0gTk9UX0VRVUFMX1RPX0pTT05fQ09NUEFSSVNPTjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRCID0gZm91bmRFbGVtZW50QjsgLy8vXG5cbiAgICAgICAgYXJyYXlCID0gZGVsZXRlRWxlbWVudChhcnJheUIsIGVsZW1lbnRBKTsgLy8vXG5cbiAgICAgICAgYXJyYXlCID0gZGVsZXRlRWxlbWVudChhcnJheUIsIGVsZW1lbnRCKTsgLy8vXG5cbiAgICAgICAgY29uc3QganNvbkEgPSBhcnJheUIsICAvLy9cbiAgICAgICAgICAgICAganNvbkIgPSBhcnJheUIsICAvLy9cbiAgICAgICAgICAgICAgcmVtYWluaW5nSlNPTkNvbXBhcmlzb24gPSBjb21wYXJlSlNPTihqc29uQSwganNvbkIpO1xuXG4gICAgICAgIGlmIChyZW1haW5pbmdKU09OQ29tcGFyaXNvbiA9PT0gTk9UX0VRVUFMX1RPX0pTT05fQ09NUEFSSVNPTikge1xuICAgICAgICAgIGpzb25Db21wYXJpc29uID0gTk9UX0VRVUFMX1RPX0pTT05fQ09NUEFSSVNPTjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoKGZpcnN0SnNvbkNvbXBhcmlzb24gPT09IFNUUklDVExZX0xFU1NfVEhBTl9KU09OX0NPTVBBUklTT04pIHx8IChyZW1haW5pbmdKU09OQ29tcGFyaXNvbiA9PT0gU1RSSUNUTFlfTEVTU19USEFOX0pTT05fQ09NUEFSSVNPTikpIHtcbiAgICAgICAgICAgIGpzb25Db21wYXJpc29uID0gU1RSSUNUTFlfTEVTU19USEFOX0pTT05fQ09NUEFSSVNPTjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAganNvbkNvbXBhcmlzb24gPSBOT1RfRVFVQUxfVE9fSlNPTl9DT01QQVJJU09OO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBqc29uQ29tcGFyaXNvbiA9IE5PVF9FUVVBTF9UT19KU09OX0NPTVBBUklTT047XG4gIH1cblxuICByZXR1cm4ganNvbkNvbXBhcmlzb247XG59XG5cbmZ1bmN0aW9uIGNvbXBhcmVPYmplY3RzKG9iamVjdEEsIG9iamVjdEIpIHtcbiAgbGV0IGpzb25Db21wYXJpc29uO1xuXG4gIGNvbnN0IGtleXNBID0gT2JqZWN0LmtleXMob2JqZWN0QSksXG4gICAgICAgIGtleXNCID0gT2JqZWN0LmtleXMob2JqZWN0QiksXG4gICAgICAgIGtleXNBTGVuZ3RoID0ga2V5c0EubGVuZ3RoLFxuICAgICAgICBrZXlzQkxlbmd0aCA9IGtleXNCLmxlbmd0aDtcblxuICBpZiAoa2V5c0FMZW5ndGggPD0ga2V5c0JMZW5ndGgpIHtcbiAgICBpZiAoa2V5c0FMZW5ndGggPT09IDApIHtcbiAgICAgIGlmIChrZXlzQUxlbmd0aCA9PT0ga2V5c0JMZW5ndGgpIHtcbiAgICAgICAganNvbkNvbXBhcmlzb24gPSBFUVVBTF9UT19KU09OX0NPTVBBUklTT047XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBqc29uQ29tcGFyaXNvbiA9IFNUUklDVExZX0xFU1NfVEhBTl9KU09OX0NPTVBBUklTT047XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBmaXJzdEpzb25Db21wYXJpc29uID0gTk9UX0VRVUFMX1RPX0pTT05fQ09NUEFSSVNPTjtcblxuICAgICAgY29uc3QgZmlyc3RLZXlBID0gZmlyc3Qoa2V5c0EpLFxuICAgICAgICAgICAga2V5QSA9IGZpcnN0S2V5QTsgLy8vXG5cbiAgICAgIGtleXNCLnNvbWUoKGtleUIpID0+IHtcbiAgICAgICAgaWYgKGtleUIgPT09IGtleUEpIHtcbiAgICAgICAgICBjb25zdCB2YWx1ZUEgPSBvYmplY3RBW2tleUFdLFxuICAgICAgICAgICAgICAgIHZhbHVlQiA9IG9iamVjdEJba2V5Ql0sXG4gICAgICAgICAgICAgICAganNvbkEgPSB2YWx1ZUEsIC8vL1xuICAgICAgICAgICAgICAgIGpzb25CID0gdmFsdWVCOyAvLy9cblxuICAgICAgICAgIGZpcnN0SnNvbkNvbXBhcmlzb24gPSBjb21wYXJlSlNPTihqc29uQSwganNvbkIpO1xuXG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZmlyc3RKc29uQ29tcGFyaXNvbiA9PT0gTk9UX0VRVUFMX1RPX0pTT05fQ09NUEFSSVNPTikge1xuICAgICAgICBqc29uQ29tcGFyaXNvbiA9IE5PVF9FUVVBTF9UT19KU09OX0NPTVBBUklTT047XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBrZXlCID0ga2V5QTsgIC8vL1xuXG4gICAgICAgIG9iamVjdEEgPSBkZWxldGVLZXkob2JqZWN0QSwga2V5QSk7IC8vL1xuXG4gICAgICAgIG9iamVjdEIgPSBkZWxldGVLZXkob2JqZWN0Qiwga2V5Qik7IC8vL1xuXG4gICAgICAgIGNvbnN0IGpzb25BID0gb2JqZWN0QSwgIC8vL1xuICAgICAgICAgICAgICBqc29uQiA9IG9iamVjdEIsICAvLy9cbiAgICAgICAgICAgICAgcmVtYWluaW5nSlNPTkNvbXBhcmlzb24gPSBjb21wYXJlSlNPTihqc29uQSwganNvbkIpO1xuXG4gICAgICAgIGlmIChyZW1haW5pbmdKU09OQ29tcGFyaXNvbiA9PT0gTk9UX0VRVUFMX1RPX0pTT05fQ09NUEFSSVNPTikge1xuICAgICAgICAgIGpzb25Db21wYXJpc29uID0gTk9UX0VRVUFMX1RPX0pTT05fQ09NUEFSSVNPTjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoKGZpcnN0SnNvbkNvbXBhcmlzb24gPT09IFNUUklDVExZX0xFU1NfVEhBTl9KU09OX0NPTVBBUklTT04pIHx8IChyZW1haW5pbmdKU09OQ29tcGFyaXNvbiA9PT0gU1RSSUNUTFlfTEVTU19USEFOX0pTT05fQ09NUEFSSVNPTikpIHtcbiAgICAgICAgICAgIGpzb25Db21wYXJpc29uID0gU1RSSUNUTFlfTEVTU19USEFOX0pTT05fQ09NUEFSSVNPTjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAganNvbkNvbXBhcmlzb24gPSBOT1RfRVFVQUxfVE9fSlNPTl9DT01QQVJJU09OO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBqc29uQ29tcGFyaXNvbiA9IE5PVF9FUVVBTF9UT19KU09OX0NPTVBBUklTT047XG4gIH1cblxuICByZXR1cm4ganNvbkNvbXBhcmlzb247XG59XG5cbmZ1bmN0aW9uIGNvbXBhcmVQcmltaXRpdmVzKHByaW1pdGl2ZUEsIHByaW1pdGl2ZUIpIHtcbiAgbGV0IGpzb25Db21wYXJpc29uO1xuXG4gIGlmIChwcmltaXRpdmVBID09PSBwcmltaXRpdmVCKSB7XG4gICAganNvbkNvbXBhcmlzb24gPSBFUVVBTF9UT19KU09OX0NPTVBBUklTT047XG4gIH0gZWxzZSB7XG4gICAganNvbkNvbXBhcmlzb24gPSBOT1RfRVFVQUxfVE9fSlNPTl9DT01QQVJJU09OO1xuICB9XG5cbiAgcmV0dXJuIGpzb25Db21wYXJpc29uO1xufVxuXG5mdW5jdGlvbiBkZWxldGVFbGVtZW50KGFycmF5LCBlbGVtZW50KSB7XG4gIGNvbnN0IGRlbGV0ZWRFbGVtZW50ID0gZWxlbWVudDsgLy8vXG5cbiAgYXJyYXkgPSBhcnJheS5yZWR1Y2UoKGFycmF5LCBlbGVtZW50KSA9PiB7ICAvLy9cbiAgICBpZiAoZWxlbWVudCAhPT0gZGVsZXRlZEVsZW1lbnQpIHtcbiAgICAgIGFycmF5LnB1c2goZWxlbWVudCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFycmF5O1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIGFycmF5O1xufVxuXG5mdW5jdGlvbiBkZWxldGVLZXkob2JqZWN0LCBrZXkpIHtcbiAgY29uc3QgZGVsZXRlZEtleSA9IGtleSwgLy8vXG4gICAgICAgIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpLFxuICAgICAgICB2YWx1ZXMgPSBPYmplY3QudmFsdWVzKG9iamVjdCk7XG5cbiAgb2JqZWN0ID0ga2V5cy5yZWR1Y2UoKG9iamVjdCwga2V5LCBpbmRleCkgPT4geyAgLy8vXG4gICAgaWYgKGtleSAhPT0gZGVsZXRlZEtleSkge1xuICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaW5kZXhdO1xuXG4gICAgICBvYmplY3Rba2V5XSA9IHZhbHVlO1xuICAgIH1cblxuICAgIHJldHVybiBvYmplY3Q7XG4gIH0sIHt9KTtcblxuICByZXR1cm4gb2JqZWN0O1xufVxuIl0sIm5hbWVzIjpbImNvbXBhcmVKU09OIiwiYXJyYXlVdGlsaXRpZXMiLCJyZXF1aXJlIiwiZmlyc3QiLCJqc29uQSIsImpzb25CIiwianNvbkNvbXBhcmlzb24iLCJNQUpPUl9WRVJTSU9OX05VTUJFUl9DSEFOR0UiLCJqc29uQVR5cGUiLCJ0eXBlT2YiLCJqc29uQlR5cGUiLCJqc29uVHlwZSIsIkFSUkFZX0pTT05fVFlQRSIsImFycmF5QSIsImFycmF5QiIsImNvbXBhcmVBcnJheXMiLCJPQkpFQ1RfSlNPTl9UWVBFIiwib2JqZWN0QSIsIm9iamVjdEIiLCJjb21wYXJlT2JqZWN0cyIsIlBSSU1JVElWRV9KU09OX1RZUEUiLCJwcmltaXRpdmVBIiwicHJpbWl0aXZlQiIsImNvbXBhcmVQcmltaXRpdmVzIiwiYXJyYXlBTGVuZ3RoIiwibGVuZ3RoIiwiYXJyYXlCTGVuZ3RoIiwiRVFVQUxfVE9fSlNPTl9DT01QQVJJU09OIiwiU1RSSUNUTFlfTEVTU19USEFOX0pTT05fQ09NUEFSSVNPTiIsImZpcnN0SnNvbkNvbXBhcmlzb24iLCJOT1RfRVFVQUxfVE9fSlNPTl9DT01QQVJJU09OIiwiZWxlbWVudHNBIiwiZWxlbWVudHNCIiwiZmlyc3RFbGVtZW50QSIsImVsZW1lbnRBIiwiZm91bmRFbGVtZW50QiIsInNvbWUiLCJlbGVtZW50QiIsImRlbGV0ZUVsZW1lbnQiLCJyZW1haW5pbmdKU09OQ29tcGFyaXNvbiIsImtleXNBIiwiT2JqZWN0Iiwia2V5cyIsImtleXNCIiwia2V5c0FMZW5ndGgiLCJrZXlzQkxlbmd0aCIsImZpcnN0S2V5QSIsImtleUEiLCJrZXlCIiwidmFsdWVBIiwidmFsdWVCIiwiZGVsZXRlS2V5IiwiYXJyYXkiLCJlbGVtZW50IiwiZGVsZXRlZEVsZW1lbnQiLCJyZWR1Y2UiLCJwdXNoIiwib2JqZWN0Iiwia2V5IiwiZGVsZXRlZEtleSIsInZhbHVlcyIsImluZGV4IiwidmFsdWUiXSwibWFwcGluZ3MiOiJBQUFBOzs7OytCQVVnQkE7OztlQUFBQTs7O29CQU5PO3lCQUNnRDsrQkFDb0M7QUFKM0csSUFBTSxBQUFFQyxpQkFBbUJDLFFBQVEsYUFBM0JEO0FBTVIsSUFBTSxBQUFFRSxRQUFVRixlQUFWRTtBQUVELFNBQVNILFlBQVlJLEtBQUssRUFBRUMsS0FBSyxFQUFFO0lBQ3hDLElBQUlDLGlCQUFpQkM7SUFFckIsSUFBTUMsWUFBWUMsSUFBQUEsWUFBTSxFQUFDTCxRQUNuQk0sWUFBWUQsSUFBQUEsWUFBTSxFQUFDSjtJQUV6QixJQUFJRyxjQUFjRSxXQUFXO1FBQzNCLElBQU1DLFdBQVdILFdBQVcsR0FBRztRQUUvQixPQUFRRztZQUNOLEtBQUtDLDBCQUFlO2dCQUFFO29CQUNwQixJQUFNQyxTQUFTVCxPQUNUVSxTQUFTVCxPQUFPLEdBQUc7b0JBRXpCQyxpQkFBaUJTLGNBQWNGLFFBQVFDO29CQUV2QyxLQUFNO2dCQUNSO1lBRUEsS0FBS0UsMkJBQWdCO2dCQUFFO29CQUNyQixJQUFNQyxVQUFVYixPQUNWYyxVQUFVYixPQUFPLEdBQUc7b0JBRTFCQyxpQkFBaUJhLGVBQWVGLFNBQVNDO29CQUV6QyxLQUFNO2dCQUNSO1lB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